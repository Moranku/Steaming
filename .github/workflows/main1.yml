name: Ubuntu 25.04 Desktop over Tailscale
on:
  workflow_dispatch:

jobs:
  ubuntu-desktop:
    runs-on: ubuntu-latest
    timeout-minutes: 360
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Tailscale
        uses: tailscale/github-action@v2
        with:
          authkey: ${{ secrets.TAILSCALE_AUTHKEY }}
          version: 1.66.0
          args: "--ssh"

      - name: Install Ubuntu Desktop & XRDP
        run: |
          sudo apt update -y
          sudo apt install ubuntu-desktop-minimal gnome-session-flashback xrdp -y

          # Speed optimizations
          gsettings set org.gnome.desktop.interface enable-animations false || true
          gsettings set org.gnome.desktop.interface gtk-theme 'Yaru' || true
          gsettings set org.gnome.desktop.wm.preferences theme 'Yaru' || true

          sudo systemctl enable xrdp
          sudo systemctl start xrdp

      - name: Show connection info
        run: |
          echo "âœ… Ubuntu 25.04 Desktop is ready!"
          echo "Use Microsoft Remote Desktop or Android RDP app to connect."
          echo "Tailscale IP:"
          tailscale ip -4
          echo "Port: 3389"
          echo "Login user: runner"
          echo "Password: <leave empty or set your own if you wish>"
