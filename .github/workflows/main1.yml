name: Ubuntu 24.04 Desktop (GNOME) via Tailscale

on:
  workflow_dispatch:

jobs:
  ubuntu-desktop:
    runs-on: ubuntu-24.04          # <-- fixed to Ubuntu 24.04 LTS
    timeout-minutes: 360           # 6 hours max (GitHub limit)

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Tailscale
        run: |
          curl -fsSL https://tailscale.com/install.sh | sh
          sudo systemctl enable --now tailscaled
          sudo tailscale up --authkey=${{ secrets.TAILSCALE_AUTHKEY }} --hostname=ubuntu24-gnome --ssh
          echo "âœ… Tailscale connected!"
          tailscale ip -4

      - name: Install Ubuntu Desktop (GNOME) + XRDP
        run: |
          sudo apt update -y
          sudo DEBIAN_FRONTEND=noninteractive apt install -y ubuntu-desktop-minimal gnome-shell xrdp dbus-x11
          sudo systemctl enable xrdp
          sudo systemctl start xrdp
          echo "runner:1234" | sudo chpasswd
          sudo adduser runner ssl-cert
          echo "âœ… Ubuntu Desktop and RDP ready!"

      - name: Display Connection Info
        run: |
          echo "-----------------------------------------"
          echo "âœ… Ubuntu 24.04 GNOME Desktop is running!"
          echo "Username : runner"
          echo "Password : 1234"
          echo "-----------------------------------------"
          echo "ðŸŒ Tailscale IP â†’"
          tailscale ip -4
          echo "Use RDP (client or Android app) â†’ IP:3389"
          echo "-----------------------------------------"

      - name: Keep Alive
        run: |
          echo "Ubuntu Desktop is active... Stop the workflow to end."
          while true; do sleep 300; done
