name: Ubuntu 25.04 Desktop over Tailscale

on:
  workflow_dispatch:

jobs:
  ubuntu-desktop:
    runs-on: ubuntu-latest
    timeout-minutes: 360  # Keeps it alive for up to 6 hours (GitHub limit)

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Tailscale
        run: |
          curl -fsSL https://tailscale.com/install.sh | sh
          sudo tailscale up --authkey=${{ secrets.TAILSCALE_AUTHKEY }} --hostname=ubuntu-desktop

      - name: Install Ubuntu Desktop (GNOME) and XRDP
        run: |
          sudo apt update
          sudo apt install -y ubuntu-desktop gnome-terminal xrdp dbus-x11
          sudo systemctl enable xrdp
          sudo systemctl start xrdp
          sudo adduser --disabled-password --gecos "" rdpuser
          echo 'rdpuser:1234' | sudo chpasswd
          sudo usermod -aG sudo rdpuser

      - name: Show connection info
        run: |
          echo "âœ… Ubuntu 25.04 Desktop is ready!"
          echo "----------------------------------"
          echo "User: rdpuser"
          echo "Pass: 1234"
          echo "Tailscale IP:"
          tailscale ip -4
          echo "----------------------------------"
          echo "Keep this job running to stay connected."

      - name: Keep Alive
        run: |
          echo "Ubuntu Desktop is running..."
          while true; do sleep 300; done          echo "Tailscale IP:"
          tailscale ip -4
          echo "Port: 3389"
          echo "Login user: runner"
          echo "Password: <leave empty or set your own if you wish>"
